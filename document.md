# Figma 图片下载工具API接口使用说明

根据项目源代码和[Figma官方API文档](https://www.figma.com/developers/api)，本项目主要使用了以下几个Figma API接口：

## 1. 获取文件信息

**请求方式**：`GET`

**接口URL**：`https://api.figma.com/v1/files/:file_key`

**参数**：
- `:file_key`：Figma文件的唯一标识符。

**请求头**：
- `X-Figma-Token`：用于认证的访问令牌。

**功能描述**：
此接口用于获取指定Figma文件的详细信息，包括文件中的页面、图层结构等。在本项目中，通过调用此接口可以获取文件内容，进而根据用户指定的节点类型过滤出需要导出的节点。

## 2. 获取图片

**请求方式**：`GET`

**接口URL**：`https://api.figma.com/v1/images/:file_key`

**参数**：
- `:file_key`：Figma文件的唯一标识符。
- `ids`：需要导出图片的节点ID，多个ID用逗号分隔。
- `scale`：图片缩放比例，范围从0.01到4之间。
- `format`：图片输出格式，可以是`jpg`、`png`、`svg`或`pdf`。

**请求头**：
- `X-Figma-Token`：用于认证的访问令牌。

**功能描述**：
此接口用于根据节点ID导出Figma文件中的图片。在本项目中，首先根据用户指定的节点类型过滤出需要导出的节点，然后使用此接口导出这些节点的图片，并根据用户指定的缩放比例和格式进行导出。

### 使用示例

假设我们有一个Figma文件，其文件标识符为`abc123`，我们想要导出此文件中ID为`123:456`的节点的图片，缩放比例为2，格式为`png`，则可以构造如下请求：

```http
GET https://api.figma.com/v1/images/abc123?ids=123:456&scale=2&format=png
Headers:
X-Figma-Token: your_access_token
```


### 注意事项

- 在使用Figma API时，需要注意API的调用频率限制，以避免因过多请求而被限制访问。
- `X-Figma-Token`访问令牌需要保密，不应在公共代码库或公网上暴露。

通过上述接口的使用，结合项目源代码，可以实现从Figma项目中按需下载预览图片的功能，为设计师和开发者提供便利。

## 如何获取Figma访问令牌 (Access Token)

为了使用Figma API，您需要一个访问令牌。以下是获取访问令牌的步骤：

1. 登录您的Figma账户。
2. 在右上角点击您的头像，然后选择“设置”。
3. 在左侧菜单中，选择“个人访问令牌”。
4. 点击“创建新的个人访问令牌”。
5. 输入令牌的描述（例如，为了标识用途），然后点击“创建”。
6. 系统会显示您的新令牌。请确保复制并保存好这个令牌，因为它不会再次显示。

**注意**：请妥善保管您的访问令牌，不要泄露给他人，因为它允许访问您账户中的Figma文件。

## Figma文件结构和节点类型

Figma文件是一个树形结构，包含多种节点类型，每种类型都有其独特的属性和用途。以下是一些常见的节点类型及其解释：

- **DOCUMENT**：文档的根节点，包含所有其他节点。
- **CANVAS**：画布节点，代表Figma文件中的画布，可以包含图层和其他节点。
- **FRAME**：框架节点，用于组织设计中的元素，可以包含其他节点，如组件、形状等。
- **GROUP**：组节点，用于将多个节点组合在一起，以便作为一个整体进行操作。
- **VECTOR**：矢量图形节点，代表矢量图形元素，如路径、圆形、矩形等。
- **TEXT**：文本节点，包含文本内容及其样式信息。
- **COMPONENT**：组件节点，定义可重用的设计元素，如按钮、图标等。
- **INSTANCE**：组件实例节点，是组件的一个实例，继承了组件的属性，但也可以有自己的覆盖属性。

每个节点都有一系列属性，如`id`（节点的唯一标识符）、`name`（节点名称）、`visible`（节点是否可见）等。此外，节点可能包含特定于类型的属性，如文本节点的`fontSize`、`fontWeight`等。

通过理解Figma文件的结构和节点类型，您可以更有效地使用API来查询和操作设计文件。

## Figma API的高级使用

除了基本的文件信息获取和图片导出，Figma API还提供了一系列高级功能，使开发者能够更深入地与Figma设计交互。以下是一些高级用法的概述：

### 1. 版本历史

Figma API允许您访问文件的版本历史，这意味着您可以获取到文件的早期版本信息，并查看设计的迭代过程。

**请求方式**：`GET`

**接口URL**：`https://api.figma.com/v1/files/:file_key/versions`

这个接口可以帮助开发者构建版本对比工具，或者恢复到特定的设计版本。

### 2. 评论

Figma API支持读取和添加文件中的评论，这使得开发者可以构建自定义的设计反馈系统。

**获取评论**：

**请求方式**：`GET`

**接口URL**：`https://api.figma.com/v1/files/:file_key/comments`

**添加评论**：

**请求方式**：`POST`

**接口URL**：`https://api.figma.com/v1/files/:file_key/comments`

**请求体**：包含评论内容和位置信息。

通过集成评论功能，可以在不离开开发环境的情况下，直接在设计文件上进行沟通和反馈。

### 3. 组件和样式

Figma API允许查询文件中定义的组件和样式，这对于构建设计系统和确保设计一致性非常有用。

**获取文件中的组件**：

**请求方式**：`GET`

**接口URL**：`https://api.figma.com/v1/files/:file_key/components`

**获取文件中的样式**：

**请求方式**：`GET`

**接口URL**：`https://api.figma.com/v1/files/:file_key/styles`

这些接口可以帮助开发者自动化检查设计规范，或者在不同项目之间共享和重用组件和样式。

### 4. 实时协作

通过Figma的Webhooks，开发者可以接收到文件变更的实时通知，这为实现实时协作工具提供了可能。

要使用Webhooks，您需要在Figma的设置中配置您的服务器地址，并选择您感兴趣的事件类型。当这些事件发生时，Figma会向您的服务器发送HTTP POST请求，包含事件的详细信息。

### 结论

Figma API的强大功能为开发者提供了广泛的可能性，从基本的设计信息获取和图片导出，到高级的版本控制、评论交互、组件和样式管理，乃至实时协作。通过深入了解和利用这些API，开发者可以构建丰富的工具和应用，以支持设计和开发流程的各个方面。